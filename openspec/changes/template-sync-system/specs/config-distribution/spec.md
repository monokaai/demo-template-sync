# Config Distribution Spec

共通設定ファイルを複数リポジトリに配布する機能の仕様。

## ADDED Requirements

### Requirement: 中央リポジトリからファイルを配布する
システムは、中央管理リポジトリ（demo-template-sync）に配置されたファイルを、複数の子リポジトリに配布しなければならない（SHALL）。

#### Scenario: 配布元リポジトリのクローン
- **WHEN** 配布スクリプトが子リポジトリ内で実行される
- **THEN** 中央管理リポジトリを一時ディレクトリにクローンする
- **AND** クローンは浅いコピー（--depth 1）で行う

#### Scenario: ファイルのコピー
- **WHEN** includes.txtで定義されたファイルが中央リポジトリに存在する
- **THEN** そのファイルを子リポジトリの同じパスにコピーする
- **AND** 必要に応じてディレクトリを作成する

---

### Requirement: ホワイトリスト形式で配布対象を管理する
システムは、`includes.txt`ファイルで定義されたファイルのみを配布対象としなければならない（SHALL）。

#### Scenario: includes.txtのパース
- **WHEN** includes.txtを読み込む
- **THEN** `#`で始まるコメント行を無視する
- **AND** 空行を無視する

#### Scenario: パターンマッチング
- **WHEN** includes.txtの行が `pattern:filepath` 形式である
- **THEN** 子リポジトリ名がパターンにマッチする場合のみそのファイルを配布する

#### Scenario: デフォルト配布
- **WHEN** includes.txtの行にパターンプレフィックスがない
- **THEN** すべての子リポジトリにそのファイルを配布する

---

### Requirement: git-xargsによる一括処理
システムは、git-xargsを使用して複数リポジトリに対して並列で配布処理を実行しなければならない（SHALL）。

#### Scenario: 各リポジトリでのスクリプト実行
- **WHEN** git-xargsがターゲットリポジトリをクローンした後
- **THEN** 各リポジトリ内で配布スクリプト（apply.sh）を実行する

#### Scenario: 環境変数の利用
- **WHEN** 配布スクリプトが実行される
- **THEN** XARGS_REPO_NAME環境変数からターゲットリポジトリ名を取得する
- **AND** XARGS_REPO_OWNER環境変数からオーナー名を取得する

---

### Requirement: プルリクエストによる変更通知
システムは、配布されたファイルの変更をプルリクエストとして通知しなければならない（SHALL）。

#### Scenario: PRの自動作成
- **WHEN** 配布処理でファイル変更が発生する
- **THEN** git-xargsが自動的にプルリクエストを作成する
- **AND** PRタイトルに変更内容を示すプレフィックスを含める

#### Scenario: コンフリクト発生時の対応
- **WHEN** プルリクエストでコンフリクトが発生する
- **THEN** 各リポジトリの担当者がコンフリクトを解決する
- **AND** システムはコンフリクト解決を待ってからマージする

---

### Requirement: 配布対象リポジトリの管理
システムは、配布対象リポジトリをテキストファイルで管理しなければならない（SHALL）。

#### Scenario: リポジトリリストの読み込み
- **WHEN** 配布処理が開始される
- **THEN** `repos/`ディレクトリ内のテキストファイルからターゲットリポジトリを読み込む

#### Scenario: バッチ処理
- **WHEN** 複数のリポジトリリストファイルが存在する
- **THEN** test.txt（テスト用）、production.txt（本番用）など段階的に配布対象を拡大する
